"use strict";function _slicedToArray(e,t){return _arrayWithHoles(e)||_iterableToArrayLimit(e,t)||_unsupportedIterableToArray(e,t)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){var a;if(e)return"string"==typeof e?_arrayLikeToArray(e,t):"Map"===(a="Object"===(a=Object.prototype.toString.call(e).slice(8,-1))&&e.constructor?e.constructor.name:a)||"Set"===a?Array.from(e):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?_arrayLikeToArray(e,t):void 0}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,n=new Array(t);a<t;a++)n[a]=e[a];return n}function _iterableToArrayLimit(e,t){var a=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=a){var n,o,r,i,l=[],c=!0,d=!1;try{if(r=(a=a.call(e)).next,0===t){if(Object(a)!==a)return;c=!1}else for(;!(c=(n=r.call(a)).done)&&(l.push(n.value),l.length!==t);c=!0);}catch(e){d=!0,o=e}finally{try{if(!c&&null!=a.return&&(i=a.return(),Object(i)!==i))return}finally{if(d)throw o}}return l}}function _arrayWithHoles(e){if(Array.isArray(e))return e}!function(c){var e=document.getElementById("tmpl-modal-template-condition"),n=document.getElementById("tmpl-elementor-new-template"),a=0,t=[],o="";function r(e){jQuery.ajax({url:ajaxurl,type:"get",dataType:"json",data:{nonce:HappyAddonsEditor.editor_nonce,action:"ha_cond_template_type",post_id:e},success:function(e){e&&e.data&&e.data}})}"undefined"!=typeof elementor&&(elementor.on("panel:init",function(e){var t;r(a=elementor.config.document.id),t=a,jQuery.ajax({url:ajaxurl,type:"get",dataType:"json",data:{nonce:HappyAddonsEditor.editor_nonce,action:"ha_cond_get_current",template_id:t},success:function(e){e&&e.data&&(o=e.data)}}),elementor.getPanelView().footer.currentView.addSubMenuItem("saver-options",{before:"save-draft",name:"haconditions",icon:"ha-template-elements",title:"Template Conditions",callback:function(){return elementor.trigger("ha:templateCondition")}})}),elementor.channels.editor.on("elementorThemeBuilder:ApplyPreview",function(e){r(a)}),elementor.on("set:page",function(e){console.log(e)})),c("body").append(e.innerHTML),"undefined"!=typeof elementor&&(elementor.on("ha:templateCondition",function(e){var t=c(".ha-template-condition-wrap");console.log(t.html()),""==t.html()&&(t.append(o),t.find("select").trigger("change")),c(".ha-template-notice").removeClass("error").text(""),MicroModal.show("modal-new-template-condition")}),elementor.on("ha:templateConditionChange",function(e){var o;o=[],c(".ha-template-condition-wrap").find(".ha-template-condition-item").each(function(){var e=c(this).find(".ha-tce-type select").val(),t=c(this).find(".ha-tce-name select").val(),a=c(this).find(".ha-tce-sub_name select").val(),n=c(this).find(".ha-tce-sub_id select").val(),e=e+"/"+t;a&&(e+="/"+a),n&&(e+="/"+n.trim()),o.push(e)}),t=o})),c(document).on("click",".ha-cond-repeater-add",function(){var e,t=c(".ha-template-condition-wrap"),a=(e=n.innerHTML,a=Math.random().toString(36).replace("0.",""),e=e.replace(/{{([^{}]+)}}/g,a));t.append(a),elementor.trigger("ha:templateConditionChange")}),c(document).on("click",".ha-template-condition-remove",function(){c(this).parent().remove(),elementor.trigger("ha:templateConditionChange")}),c(document).on("click","#ha-template-save-data",function(){var e;(e=document.getElementById("elementor-panel-saver-button-publish")).classList.add("elementor-button-state"),a=elementor.config.document.id,jQuery.ajax({url:ajaxurl,type:"post",dataType:"json",data:{nonce:HappyAddonsEditor.editor_nonce,action:"ha_condition_update",conds:t,template_id:a},success:function(e){e&&(!e.success&&e.hasOwnProperty("data")&&e.data.hasOwnProperty("msg")?c(".ha-template-notice").addClass("error").text(e.data.msg):(MicroModal.close("modal-new-template-condition"),c(".ha-template-notice").removeClass("error").text("")))}}),setTimeout(function(){e.classList.remove("elementor-button-state")},500)}),c(document).on("change",".ha-template-condition-wrap select",function(e){var t,a,n,o,r,i,l;"select"==e.target.localName&&(n=e.target.dataset.parent,t=e.target.dataset.setting,e=e.target.value,c("[data-id='type-"+n+"']"),a=c("[data-id='name-"+n+"']"),r=c("[data-id='sub_name-"+n+"']"),n=c("[data-id='sub_id-"+n+"']"),"name"==t&&("general"==e?(r.parent().hide(),n.parent().hide()):(r.parent().show(),o=r.data("selected")?r.data("selected"):"",function(t,e,a){jQuery.ajax({url:ajaxurl,type:"get",dataType:"json",data:{nonce:HappyAddonsEditor.editor_nonce,action:"ha_condition_autocomplete",object_type:e},success:function(e){e&&e.data&&(e=function(e,t){for(var a="",n=0,o=Object.entries(e);n<o.length;n++){var r=_slicedToArray(o[n],2),i=r[0],r=r[1];if(r.hasOwnProperty("type")){a+="<optgroup label='"+r.title+"'>";for(var l=0,c=Object.entries(r.conditions);l<c.length;l++){var d=_slicedToArray(c[l],2),s=d[0],d=d[1],p=d.is_pro,u=d.title,m="";p&&(u+=" [Pro]",m=" disabled"),a+="<option value='"+(h=s)+"' "+m+(t==h?" selected":"")+">"+u+"</option>"}a+="</optgroup>"}else{var h,p=r.is_pro,u=r.title,m="";p&&(u+=" [Pro]",m=" disabled"),a+="<option value='"+(h=i)+"' "+m+(t==h?" selected":"")+">"+u+"</option>"}}return a}(e.data,a),t.html(e))}})}(r,a.val(),o))),"sub_name"==t)&&((r={post:"post",in_category:"category",in_category_children:"category",in_post_tag:"post_tag",post_by_author:"author",page:"page",page_by_author:"author",child_of:"page",any_child_of:"page",by_author:"author"}).hasOwnProperty(e)?(n.parent().show(),i=r[e],l=e,["post","page"].includes(i)&&(l=i,i="post"),["category","post_tag"].includes(i)&&(l=i,i="tax"),n.select2({ajax:{url:ajaxurl,dataType:"json",delay:250,data:function(e){return{nonce:HappyAddonsEditor.editor_nonce,action:"ha_condition_autocomplete",q:e.term,object_type:i,object_term:l}},processResults:function(e){var a;return e.success&&0!==e.data.length?(a=[],_.each(e.data,function(e,t){a.push({id:t,text:e})}),{results:a}):{results:[{id:-1,text:"No results found",disabled:!0}]}}},minimumInputLength:2,cache:!0,placeholder:"All",allowClear:!0,dropdownCssClass:"ha-template-condition-dropdown"})):n.parent().hide()),elementor.trigger("ha:templateConditionChange")}),elementor.saver.on("after:save",function(e){console.log("after save"),console.log(e),"inherit"!=e.status&&elementor.trigger("ha:templateCondition")})}(jQuery);